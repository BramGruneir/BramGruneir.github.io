(this.webpackJsonpsurvival=this.webpackJsonpsurvival||[]).push([[0],{17:function(e,t,a){e.exports=a(36)},22:function(e,t,a){},23:function(e,t,a){},36:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(15),l=a.n(r),i=(a(22),a(2)),c=a(16),o=a(6),u=a(8),d=a(9),h=a(12),m=a(11),p=(a(23),a(4)),v=a.n(p),C=a(10),S=a.n(C),f=a(1),g=a.n(f),E=g.a.parseBytes("150 GB").bytes,y=g.a.parseBytes("4 GiB").bytes,N={1:["Nodes"],2:["Data Centers","Nodes"],3:["Regions","Availability Zones","Nodes"],4:["Regions","Data Centers","Availability Zones","Nodes"],5:["Regions","Data Centers","Availability Zones","Racks","Nodes"]},b={1:[3],2:[3,3],3:[3,3,3],4:[3,3,3,3],5:[3,3,3,3,3]};function k(e,t,a,n){return{Storage:{Capacity:e*E,CapacityPerNode:e*E/n,RealCapacity:e*E/t*1.4,IOPS:500*e,IOPS_per_node:500*a,MBPS:30*e,MBPS_per_node:30*a,RAM_per_node:y*a},Concurrency:{Connections:4*e}}}function F(e){return S.a.plural(e||"")}function w(e){return S.a.singular(e||"")}var R=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(d.a)(a,[{key:"render",value:function(){var e,t=this.props.children.map((function(e){return s.a.createElement(a,e)})),n=(e=this.props).failed?"Box-failed":0===e.replicas?"Box-empty":"Box",r=this.props.replicas>0?"Replicas-full":"Replicas-empty";return s.a.createElement("div",{className:"".concat(n)},s.a.createElement("div",null,this.props.name," ",this.props.id),s.a.createElement("div",{className:"".concat(r)},"Replicas ",this.props.replicas),s.a.createElement("div",{className:this.props.className},t))}}]),a}(s.a.Component);function P(e,t,a){return e<t?t:e>a?a:e}function M(e){return{levelCount:e,names:Object(o.a)(N[e]),counts:Object(o.a)(b[e]),replicationFactor:3,failureMode:1,vCPUs:4}}function A(e){var t=v.a.stringify(e,{arrayFormat:"comma"}),a=v.a.parseUrl(window.location.href);if(t!==v.a.stringify(a.query,{arrayFormat:"comma"})){var n=a.url+"?"+t;window.history.pushState(e,"CockroachDB Survival Tool",n)}}function O(e){e.levelCount=P(e.levelCount,1,5);for(var t=M(e.levelCount),a=0;a<e.levelCount;a++)e.names[a]=e.names[a]||t.names[a],e.counts[a]=P(e.counts[a],1,a===e.levelCount-1?100:10);return e.names.length>e.levelCount&&(e.names=e.names.slice(0,e.levelCount)),e.counts.length>e.levelCount&&(e.counts=e.counts.slice(0,e.levelCount)),e.replicationFactor%2===0&&e.replicationFactor--,e.replicationFactor=P(e.replicationFactor,1,99),e.failureMode=P(e.failureMode,0,e.levelCount),e.vCPUs=P(e.vCPUs,2,256),e}function z(){var e=M(5),t=M(5);return Object.entries(v.a.parse(window.location.search,{arrayFormat:"comma"})).forEach((function(a){var n=Object(c.a)(a,2),s=n[0],r=n[1];switch(s){case"counts":if(null==r||!Array.isArray(r)){t.counts=e.counts;break}if(!Array.isArray(r)){t.counts=e.counts;break}r.forEach((function(a,n){t.counts[n]=parseInt(a+"")||e.counts[n]}));break;case"names":if(null==r||!Array.isArray(r)){t.names=e.names;break}if(!Array.isArray(r)){t.names=e.names;break}t.names=r;break;case"replicationFactor":t.replicationFactor=parseInt(r+"")||e.replicationFactor;break;case"failureMode":t.failureMode=parseInt(r+"")||e.failureMode;break;case"levelCount":t.levelCount=parseInt(r+"")||e.levelCount;break;case"vCPUS":t.levelCount=parseInt(r+"")||e.vCPUs}})),t=O(t)}var U=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(u.a)(this,a),n=t.call(this,e);var s=M(3);return 0===window.location.search.length?A(s):s=z(),n.state={userState:s,failures:new Array(s.levelCount).fill(0),deadReplicas:0,allowableDead:0,nodes:{key:"sentinel",id:0,failed:!1,replicas:0,name:"sentinel",children:[],className:"sentinel",depth:0},nodeCount:0,specs:k(0,0,0,0)},n.handleCountChange=n.handleCountChange.bind(Object(i.a)(n)),n.handleNameChange=n.handleNameChange.bind(Object(i.a)(n)),n.handleReplicationFactorChange=n.handleReplicationFactorChange.bind(Object(i.a)(n)),n.handleFailureModeChange=n.handleFailureModeChange.bind(Object(i.a)(n)),n.handleLevelsChange=n.handleLevelsChange.bind(Object(i.a)(n)),n.handlevCPUChange=n.handlevCPUChange.bind(Object(i.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("popstate",(function(t){e.handlePopState()}));var t=this.getCurrentState();this.setState(this.update(t))}},{key:"handlePopState",value:function(){var e=this.getCurrentState();e.userState=e.userState=z(),this.setState(this.update(e))}},{key:"getCurrentState",value:function(){return{userState:this.state.userState,failures:this.state.failures,deadReplicas:this.state.deadReplicas,allowableDead:this.state.allowableDead,nodes:this.state.nodes,nodeCount:this.state.nodeCount,specs:this.state.specs}}},{key:"handleCountChange",value:function(e,t){var a=this.getCurrentState(),n=M(a.userState.levelCount),s=parseInt(t.target.value);s=0===s?s:s||n.counts[e],a.userState.counts[e]=s,this.setState(this.update(a))}},{key:"handleNameChange",value:function(e,t){var a=this.getCurrentState();a.userState.names[e]=t.target.value,this.setState(this.update(a))}},{key:"handleReplicationFactorChange",value:function(e){var t=this.getCurrentState(),a=M(t.userState.levelCount),n=parseInt(e.target.value)||a.replicationFactor;n%2===0&&(this.state.userState.replicationFactor>n?n--:n++),t.userState.replicationFactor=n,this.setState(this.update(t),this.forceUpdate)}},{key:"handleFailureModeChange",value:function(e){var t=this.getCurrentState();t.userState.failureMode=parseInt(e.target.value)||0,this.setState(this.update(t))}},{key:"handleLevelsChange",value:function(e){var t=parseInt(e.target.value);t=P(t=0===t?t:t||3,1,5);var a=this.getCurrentState();if(a.userState.levelCount>t)a.userState.names.shift(),a.userState.counts.shift();else if(a.userState.levelCount<t){var n=M(t);a.userState.names=n.names,a.userState.counts.unshift(n.counts[0])}a.userState.levelCount=t,a.failures=new Array(t).fill(0),this.setState(this.update(a))}},{key:"handlevCPUChange",value:function(e){var t=this.getCurrentState(),a=M(t.userState.levelCount);t.userState.vCPUs=parseInt(e.target.value)||a.vCPUs,this.setState(this.update(t))}},{key:"populateNodeChildren",value:function(e,t){for(var a=0;a<t.counts[e.depth];a++){var n={key:"".concat(e.key,"-").concat(a+1),id:a+1,failed:!1,replicas:0,name:w(t.names[e.depth]),children:[],className:"level".concat(e.depth+1),depth:e.depth+1};this.populateNodeChildren(n,t),e.children.push(n)}}},{key:"addRange",value:function(e,t){for(var a=Math.floor(t/e.children.length),n=t%e.children.length,s=new Array(e.children.length).fill(a),r=0;r<n;r++)s[r]++;for(var l=0;l<e.children.length&&s[l]>0;l++)this.addRange(e.children[l],s[l]);e.replicas=t}},{key:"killReplicas",value:function(e,t,a,n,s){if(0===t||0===a||0===e.replicas)return 0;for(var r,l=[{n:e,i:0}],i=[],c=a,u=0;c>0;){if(0===l.length){if(0===i.length)break;l=Object(o.a)(i),i=[],u=0}if(void 0===(r=l.shift())||0===r.n.replicas)break;var d=r.n.children[r.i];t<=d.depth&&d.replicas<=c&&d.replicas>=u?(d.failed=!0,n[d.depth]++,c-=d.replicas):d.children.length>0&&(i.push({n:d,i:0}),u=Math.max(u,d.replicas)),r.i+1<r.n.children.length&&l.push({n:r.n,i:r.i+1})}return a-c}},{key:"update",value:function(e){return e.userState=O(e.userState),A(e.userState),e.allowableDead=Math.floor(e.userState.replicationFactor/2),e.nodeCount=e.userState.counts.reduce((function(e,t){return e*t}),1),e.nodes={key:"s",id:0,failed:!1,replicas:0,name:"sentinel",children:[],className:"sentinel",depth:0},this.populateNodeChildren(e.nodes,e.userState),this.addRange(e.nodes,e.userState.replicationFactor),e.failures=new Array(e.userState.levelCount+1).fill(0),e.deadReplicas=e.nodeCount<e.userState.replicationFactor?0:this.killReplicas(e.nodes,e.userState.failureMode,e.allowableDead,e.failures,e.userState.levelCount),e.failures.shift(),e.specs=k(e.userState.vCPUs*e.nodeCount,e.userState.replicationFactor,e.userState.vCPUs,e.nodeCount),e}},{key:"render",value:function(){var e=this,t=this.state.userState.names[this.state.userState.names.length-1],a=Array(this.state.failures.length),n=!1;return this.state.failures.forEach((function(t,s){s<e.state.userState.failureMode-1?a[s]="Ignore":n?a[s]="Display":0===t?a[s]="Warning":(a[s]="Display",n=!0)})),s.a.createElement("div",null,s.a.createElement("h1",null,"CockroachDB Survival Tool"),s.a.createElement("div",{className:"App-form"},s.a.createElement("form",null,s.a.createElement("table",{className:"App-table"},s.a.createElement("thead",null,s.a.createElement("tr",null,this.state.userState.names.map((function(t,a){return s.a.createElement("th",{key:"title-".concat(a)},s.a.createElement("input",{className:"NameInput",type:"text",name:F(t),value:e.state.userState.names[a],onChange:function(t){return e.handleNameChange(a,t)}}))})),s.a.createElement("th",null,"Replication Factor"),s.a.createElement("th",null,"Topology Levels"))),s.a.createElement("tbody",null,s.a.createElement("tr",null,this.state.userState.names.map((function(t,a){return s.a.createElement("td",{key:"input-".concat(t,"-").concat(a)},s.a.createElement("input",{className:"App-input",type:"number",name:t,value:e.state.userState.counts[a],onChange:function(t){return e.handleCountChange(a,t)}}))})),s.a.createElement("td",null,s.a.createElement("input",{className:"App-input",name:"replicationFactor",type:"number",value:this.state.userState.replicationFactor,onChange:this.handleReplicationFactorChange})),s.a.createElement("td",null,s.a.createElement("input",{className:"App-input",type:"number",name:"levels",value:this.state.userState.levelCount,onChange:this.handleLevelsChange}))))),s.a.createElement("div",{className:"Selector"},s.a.createElement("div",null,"Failure Mode:"),s.a.createElement("select",{className:"FailureSelect",value:this.state.userState.failureMode,onChange:this.handleFailureModeChange},this.state.userState.names.map((function(e,t){return s.a.createElement("option",{value:t+1,key:"failureMode-".concat(e,"-").concat(t)},w(e))})),s.a.createElement("option",{value:0},"None"))))),this.state.nodeCount<this.state.userState.replicationFactor&&s.a.createElement("div",{className:"Underreplicated"},"The system is underreplicated: There are ",this.state.nodeCount," nodes, but ",this.state.userState.replicationFactor," are needed."),0!==this.state.userState.failureMode&&s.a.createElement("div",{className:"FailureResults"},s.a.createElement("div",null,"With ",this.state.userState.replicationFactor,"x replication you can survive a max of ",this.state.allowableDead," dead replica",1!==this.state.allowableDead&&"s","."),s.a.createElement("div",null,"This scenario will survive losing at most:"),s.a.createElement("div",{className:"FailureTable"},this.state.failures.map((function(t,n){return"Ignore"!==a[n]&&s.a.createElement("div",{className:"FailureRow",key:"failureRow-".concat(t,"-").concat(n)},s.a.createElement("div",{className:"FailureColumn"},s.a.createElement("div",{className:"FailureHeader".concat(a[n])},F(e.state.userState.names[n]))),s.a.createElement("div",{className:"FailureColumn"},s.a.createElement("div",{className:"FailureValue".concat(a[n])},e.state.failures[n])))})))),s.a.createElement("div",{className:"App-container"},this.state.nodes.children.map((function(e){return s.a.createElement(R,e)}))),s.a.createElement("form",null,s.a.createElement("div",{className:"Footer"},s.a.createElement("h2",null,"Sizing Calculations"),s.a.createElement("div",{className:"Selector"},s.a.createElement("div",null,"vCPUs per ".concat(w(t))),s.a.createElement("input",{className:"App-input",type:"number",name:"vCPUs",value:this.state.userState.vCPUs,onChange:this.handlevCPUChange})),s.a.createElement("div",{className:"SizingResults"},s.a.createElement("div",null,"With this setup, there are ",this.state.nodeCount," ",F(t)," and ",this.state.nodeCount*this.state.userState.vCPUs," vCPUs."),s.a.createElement("div",null,"Some rule of thumb sizing calculations allow for:"),s.a.createElement("div",{className:"SizingTable"},s.a.createElement("div",{className:"SizingRpw"},s.a.createElement("div",{className:"SizingColumn"},s.a.createElement("div",{className:"SizingValue"},g()(this.state.specs.Storage.Capacity,{iec:!0})," (",g()(this.state.specs.Storage.Capacity,{iec:!1}),") total storage, ",g()(this.state.specs.Storage.CapacityPerNode,{iec:!0})," (",g()(this.state.specs.Storage.CapacityPerNode,{iec:!1}),") storage per ",w(t)))),s.a.createElement("div",{className:"SizingRpw"},s.a.createElement("div",{className:"SizingColumn"},s.a.createElement("div",{className:"SizingValue"},g()(this.state.specs.Storage.RealCapacity,{iec:!0})," (",g()(this.state.specs.Storage.RealCapacity,{iec:!1}),") actual storage (due to ",this.state.userState.replicationFactor,"x replication and a compression ratio of ",40,"%)"))),s.a.createElement("div",{className:"SizingRpw"},s.a.createElement("div",{className:"SizingColumn"},s.a.createElement("div",{className:"SizingValue"},this.state.specs.Storage.IOPS.toLocaleString()," IOPS total, ",this.state.specs.Storage.IOPS_per_node.toLocaleString()," IOPS per ",w(t)))),s.a.createElement("div",{className:"SizingRpw"},s.a.createElement("div",{className:"SizingColumn"},s.a.createElement("div",{className:"SizingValue"},this.state.specs.Storage.MBPS.toLocaleString()," MBPS total, ",this.state.specs.Storage.MBPS_per_node.toLocaleString()," MBPS per ",w(t)))),s.a.createElement("div",{className:"SizingRpw"},s.a.createElement("div",{className:"SizingColumn"},s.a.createElement("div",{className:"SizingValue"},g()(this.state.specs.Storage.RAM_per_node,{iec:!0})," RAM per ",w(t)," recommended"))),s.a.createElement("div",{className:"SizingRpw"},s.a.createElement("div",{className:"SizingColumn"},s.a.createElement("div",{className:"SizingValue"},this.state.specs.Concurrency.Connections.toLocaleString()," concurrent ",s.a.createElement("i",null,"active")," connections")))),s.a.createElement("div",null,s.a.createElement("i",null,"*Please note that these values are rough approximations based on some back of the envelope calculations.")),s.a.createElement("div",null,s.a.createElement("a",{className:"Contact",href:"mailto:sales@cockroachlabs.com"},"Contact Cockroach Labs for a more complete and accurate sizing calculation."))))))}}]),a}(s.a.Component);var I=function(){return s.a.createElement("div",{className:"App"},s.a.createElement("header",{className:"App-header"},s.a.createElement(U,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(I,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[17,1,2]]]);
//# sourceMappingURL=main.b3e59804.chunk.js.map