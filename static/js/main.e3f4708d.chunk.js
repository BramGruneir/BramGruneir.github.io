(this.webpackJsonpsurvival=this.webpackJsonpsurvival||[]).push([[0],{12:function(e,a,t){e.exports=t(31)},17:function(e,a,t){},18:function(e,a,t){},31:function(e,a,t){"use strict";t.r(a);var r=t(0),i=t.n(r),n=t(10),s=t.n(n),l=(t(17),t(1)),o=t(11),c=t(2),u=t(3),d=t(5),p=t(4),h=(t(18),t(6)),m=t.n(h);function f(e){return Math.random().toString()}function v(e){return e.failed?"Box-failed":0===e.replicas?"Box-empty":"Box"}var g,b=function(e){Object(d.a)(t,e);var a=Object(p.a)(t);function t(){return Object(c.a)(this,t),a.apply(this,arguments)}return Object(u.a)(t,[{key:"render",value:function(){var e=v(this.props),a=this.props.replicas>0?"Replicas-full":"Replicas-empty";return i.a.createElement("div",{className:"".concat(e)},i.a.createElement("div",null,"Node ",this.props.id),i.a.createElement("div",{className:"".concat(a)},"Replicas ",this.props.replicas))}}]),t}(i.a.Component),C=function(e){Object(d.a)(t,e);var a=Object(p.a)(t);function t(){return Object(c.a)(this,t),a.apply(this,arguments)}return Object(u.a)(t,[{key:"render",value:function(){var e=this.props.nodes.map((function(e){return i.a.createElement(b,e)})),a=v(this.props),t=this.props.replicas>0?"Replicas-full":"Replicas-empty";return i.a.createElement("div",{className:"".concat(a)},i.a.createElement("div",null,"AZ ",this.props.id),i.a.createElement("div",{className:"".concat(t)},"Replicas ",this.props.replicas),e)}}]),t}(i.a.Component),R=function(e){Object(d.a)(t,e);var a=Object(p.a)(t);function t(){return Object(c.a)(this,t),a.apply(this,arguments)}return Object(u.a)(t,[{key:"render",value:function(){var e=this.props.availabilityZones.map((function(e){return i.a.createElement(C,e)})),a=v(this.props),t=this.props.replicas>0?"Replicas-full":"Replicas-empty";return i.a.createElement("div",{className:"".concat(a)},i.a.createElement("div",null,"DC ",this.props.id),i.a.createElement("div",{className:"".concat(t)},"Replicas ",this.props.replicas),e)}}]),t}(i.a.Component),E=function(e){Object(d.a)(t,e);var a=Object(p.a)(t);function t(){return Object(c.a)(this,t),a.apply(this,arguments)}return Object(u.a)(t,[{key:"render",value:function(){var e=this.props.datacenters.map((function(e){return i.a.createElement(R,e)})),a=v(this.props),t=this.props.replicas>0?"Replicas-full":"Replicas-empty";return i.a.createElement("div",{className:"".concat(a)},i.a.createElement("div",null,"Region ",this.props.id),i.a.createElement("div",{className:"".concat(t)},"Replicas ",this.props.replicas),i.a.createElement("div",{className:"App-container"},e))}}]),t}(i.a.Component);function N(e,a,t){return e<a?a:e>t?t:e}!function(e){e[e.None=0]="None",e[e.Region=1]="Region",e[e.DataCenter=2]="DataCenter",e[e.AvailabilityZone=3]="AvailabilityZone",e[e.Node=4]="Node"}(g||(g={}));var S={numberRegions:1,DCsPerRegion:3,AZsPerDC:3,NodesPerAZ:3,replicationFactor:3,failureMode:g.Region};function D(e){var a=m.a.stringify(e),t=m.a.parseUrl(window.location.href);if(a!==m.a.stringify(t.query)){var r=t.url+"?"+a;window.history.pushState(e,"CockroachDB Survival Tool",r)}}function Z(e){return e.numberRegions=N(e.numberRegions,1,10),e.DCsPerRegion=N(e.DCsPerRegion,1,10),e.AZsPerDC=N(e.AZsPerDC,1,10),e.NodesPerAZ=N(e.NodesPerAZ,1,100),e.replicationFactor%2===0&&e.replicationFactor--,e.replicationFactor=N(e.replicationFactor,1,99),e}function y(){var e=S;return Object.entries(m.a.parse(window.location.search)).forEach((function(a){var t=Object(o.a)(a,2),r=t[0],i=t[1];switch(r){case"numberRegions":e.numberRegions=parseInt(i+"")||S.numberRegions;break;case"DCsPerRegion":e.DCsPerRegion=parseInt(i+"")||S.DCsPerRegion;break;case"AZsPerDC":e.AZsPerDC=parseInt(i+"")||S.AZsPerDC;break;case"NodesPerAZ":e.NodesPerAZ=parseInt(i+"")||S.NodesPerAZ;break;case"replicationFactor":e.replicationFactor=parseInt(i+"")||S.replicationFactor;break;case"failureMode":e.failureMode=parseInt(i+"")||S.failureMode}})),e=Z(e)}var A=function(e){Object(d.a)(t,e);var a=Object(p.a)(t);function t(e){var r;Object(c.a)(this,t),r=a.call(this,e);var i=S;return 0===window.location.search.length?D(i):i=y(),r.state={userState:i,failedRegions:0,failedDCs:0,failedAZs:0,failedNodes:0,deadReplicas:0,allowableDead:0,regions:[]},r.handleNumberRegionsChange=r.handleNumberRegionsChange.bind(Object(l.a)(r)),r.handleDCsPerRegionChange=r.handleDCsPerRegionChange.bind(Object(l.a)(r)),r.handleAZsPerDCChange=r.handleAZsPerDCChange.bind(Object(l.a)(r)),r.handleNodesPerAZChange=r.handleNodesPerAZChange.bind(Object(l.a)(r)),r.handleReplicationFactorChange=r.handleReplicationFactorChange.bind(Object(l.a)(r)),r.handleFailureModeChange=r.handleFailureModeChange.bind(Object(l.a)(r)),r}return Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("popstate",(function(a){e.handlePopState()}));var a=this.getCurrentState();this.setState(this.update(a))}},{key:"handlePopState",value:function(){var e=this.getCurrentState();e.userState=e.userState=y(),this.setState(this.update(e))}},{key:"getCurrentState",value:function(){return{userState:this.state.userState,failedRegions:this.state.failedRegions,failedDCs:this.state.failedDCs,failedAZs:this.state.failedAZs,failedNodes:this.state.failedNodes,deadReplicas:this.state.deadReplicas,allowableDead:this.state.allowableDead,regions:[]}}},{key:"handleNumberRegionsChange",value:function(e){var a=parseInt(e.target.value)||S.numberRegions,t=this.getCurrentState();t.userState.numberRegions=a,this.setState(this.update(t))}},{key:"handleDCsPerRegionChange",value:function(e){var a=parseInt(e.target.value)||S.DCsPerRegion,t=this.getCurrentState();t.userState.DCsPerRegion=a,this.setState(this.update(t))}},{key:"handleAZsPerDCChange",value:function(e){var a=parseInt(e.target.value)||S.AZsPerDC,t=this.getCurrentState();t.userState.AZsPerDC=a,this.setState(this.update(t))}},{key:"handleNodesPerAZChange",value:function(e){var a=parseInt(e.target.value)||S.NodesPerAZ,t=this.getCurrentState();t.userState.NodesPerAZ=a,this.setState(this.update(t))}},{key:"handleReplicationFactorChange",value:function(e){var a=parseInt(e.target.value)||S.replicationFactor;a%2===0&&(this.state.userState.replicationFactor>a?a--:a++);var t=this.getCurrentState();t.userState.replicationFactor=a,this.setState(this.update(t),this.forceUpdate)}},{key:"handleFailureModeChange",value:function(e){var a=this.getCurrentState();a.userState.failureMode=parseInt(e.target.value)||g.None,this.setState(this.update(a))}},{key:"update",value:function(e){e.userState=Z(e.userState),D(e.userState),e.allowableDead=Math.floor(e.userState.replicationFactor/2),e.regions=[];for(var a=0;a<e.userState.numberRegions;a++){for(var t={key:"",id:a+1,failed:!1,datacenters:[],replicas:0},r=0;r<e.userState.DCsPerRegion;r++){for(var i={key:"",id:r+1,failed:!1,replicas:0,availabilityZones:[]},n=0;n<e.userState.AZsPerDC;n++){for(var s={key:"",id:n+1,failed:!1,replicas:0,nodes:[]},l=0;l<e.userState.NodesPerAZ;l++){var o={key:"",id:l+1,failed:!1,replicas:0};s.nodes.push(o)}i.availabilityZones.push(s)}t.datacenters.push(i)}e.regions.push(t)}for(var c=0;c<e.userState.replicationFactor;c++){var u=c%e.userState.numberRegions;e.regions[u].replicas++}if(e.regions.forEach((function(a){for(var t=0;t<a.replicas;t++){var r=t%e.userState.DCsPerRegion;a.datacenters[r].replicas++}})),e.regions.forEach((function(a){return a.datacenters.forEach((function(a){for(var t=0;t<a.replicas;t++){var r=t%e.userState.AZsPerDC;a.availabilityZones[r].replicas++}}))})),e.regions.forEach((function(a){return a.datacenters.forEach((function(a){return a.availabilityZones.forEach((function(a){for(var t=0;t<a.replicas;t++){var r=t%e.userState.NodesPerAZ;a.nodes[r].replicas++}}))}))})),e.deadReplicas=0,e.failedRegions=0,e.failedDCs=0,e.failedAZs=0,e.failedNodes=0,e.userState.failureMode===g.Region)for(var d=0;d<e.userState.numberRegions&&0!==e.regions[d].replicas&&e.deadReplicas+e.regions[d].replicas<=e.allowableDead;d++)e.regions[d].failed=!0,e.deadReplicas+=e.regions[d].replicas,e.failedRegions++;if(e.userState.failureMode>g.None&&e.userState.failureMode<=g.DataCenter&&e.deadReplicas<e.allowableDead)for(var p=-1,h=0;e.deadReplicas<e.allowableDead&&!(++p>=e.userState.numberRegions&&(p=0,++h>=e.userState.DCsPerRegion));)if(!e.regions[p].failed){if(0===e.regions[p].replicas||0===e.regions[p].datacenters[h].replicas)break;if(!(e.deadReplicas+e.regions[p].datacenters[h].replicas<=e.allowableDead))break;e.regions[p].datacenters[h].failed=!0,e.deadReplicas+=e.regions[p].datacenters[h].replicas,e.failedDCs++}if(e.userState.failureMode>g.None&&e.userState.failureMode<=g.AvailabilityZone&&e.deadReplicas<e.allowableDead)for(var m=-1,v=0,b=0;e.deadReplicas<e.allowableDead&&!(++m>=e.userState.numberRegions&&(m=0,++v>=e.userState.DCsPerRegion&&(v=0,++b>=e.userState.AZsPerDC)));)if(!e.regions[m].failed&&!e.regions[m].datacenters[v].failed){if(0===e.regions[m].replicas||0===e.regions[m].datacenters[v].replicas||0===e.regions[m].datacenters[v].availabilityZones[b].replicas)break;if(!(e.deadReplicas+e.regions[m].datacenters[v].availabilityZones[b].replicas<=e.allowableDead))break;e.regions[m].datacenters[v].availabilityZones[b].failed=!0,e.deadReplicas+=e.regions[m].datacenters[v].availabilityZones[b].replicas,e.failedAZs++}if(e.userState.failureMode>g.None&&e.userState.failureMode<=g.Node&&e.deadReplicas<e.allowableDead)for(var C=-1,R=0,E=0,N=0;e.deadReplicas<e.allowableDead&&!(++C>=e.userState.numberRegions&&(C=0,++R>=e.userState.DCsPerRegion&&(R=0,++E>=e.userState.AZsPerDC&&(E=0,++N>=e.userState.NodesPerAZ))));)if(!(e.regions[C].failed||e.regions[C].datacenters[R].failed||e.regions[C].datacenters[R].availabilityZones[E].failed)){if(0===e.regions[C].replicas||0===e.regions[C].datacenters[R].replicas||0===e.regions[C].datacenters[R].availabilityZones[E].replicas||0===e.regions[C].datacenters[R].availabilityZones[E].nodes[N].replicas)break;if(!(e.deadReplicas+e.regions[C].datacenters[R].availabilityZones[E].nodes[N].replicas<=e.allowableDead))break;e.regions[C].datacenters[R].availabilityZones[E].nodes[N].failed=!0,e.deadReplicas+=e.regions[C].datacenters[R].availabilityZones[E].nodes[N].replicas,e.failedNodes++}return e.regions.forEach((function(e){e.key=f(),e.datacenters.forEach((function(e){e.key=f(),e.availabilityZones.forEach((function(e){e.key=f(),e.nodes.forEach((function(e){e.key=f()}))}))}))})),e}},{key:"render",value:function(){var e=this.state.regions.map((function(e){return i.a.createElement(E,e)})),a=this.state.userState.numberRegions*this.state.userState.DCsPerRegion*this.state.userState.AZsPerDC*this.state.userState.NodesPerAZ;return i.a.createElement("div",null,i.a.createElement("div",{className:"App-form"},i.a.createElement("form",null,i.a.createElement("table",{className:"App-table"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,"Regions"),i.a.createElement("th",null,"DCs per Region"),i.a.createElement("th",null,"AZs per DC"),i.a.createElement("th",null,"Nodes per AZ"),i.a.createElement("th",null,"Replication Factor"))),i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",null,i.a.createElement("input",{className:"App-input",type:"number",value:this.state.userState.numberRegions,onChange:this.handleNumberRegionsChange})),i.a.createElement("td",null,i.a.createElement("input",{className:"App-input",name:"DCsPerRegion",type:"number",value:this.state.userState.DCsPerRegion,onChange:this.handleDCsPerRegionChange})),i.a.createElement("td",null,i.a.createElement("input",{className:"App-input",name:"AZsPerDC",type:"number",value:this.state.userState.AZsPerDC,onChange:this.handleAZsPerDCChange})),i.a.createElement("td",null,i.a.createElement("input",{className:"App-input",name:"NodesPerAZ",type:"number",value:this.state.userState.NodesPerAZ,onChange:this.handleNodesPerAZChange})),i.a.createElement("td",null,i.a.createElement("input",{className:"App-input",name:"replicationFactor",type:"number",value:this.state.userState.replicationFactor,onChange:this.handleReplicationFactorChange}))))),i.a.createElement("div",{className:"FailureMode"},i.a.createElement("div",null,"Failure Mode:"),i.a.createElement("select",{className:"FailureSelect",value:this.state.userState.failureMode,onChange:this.handleFailureModeChange},i.a.createElement("option",{value:g.None},"None"),i.a.createElement("option",{value:g.Region},"Region"),i.a.createElement("option",{value:g.DataCenter},"DataCenter"),i.a.createElement("option",{value:g.AvailabilityZone},"AvailabilityZone"),i.a.createElement("option",{value:g.Node},"Node"))))),a<this.state.userState.replicationFactor&&i.a.createElement("div",{className:"Underreplicated"},"The system is underreplicated: There are ",a," nodes, but ",this.state.userState.replicationFactor," are needed."),this.state.userState.failureMode!==g.None&&i.a.createElement("div",{className:"FailureResults"},i.a.createElement("div",null,"With ",this.state.userState.replicationFactor,"x replication you can survive a max of ",this.state.allowableDead," dead replica",1!==this.state.allowableDead&&"s","."),i.a.createElement("div",null,"This scenario will survive losing at most:"),i.a.createElement("div",{className:"FailureTable"},!!this.state.failedRegions&&i.a.createElement("div",{className:"FailureRow"},i.a.createElement("div",{className:"FailureColumn"},i.a.createElement("div",{className:"FailureHeader"},"Regions")),i.a.createElement("div",{className:"FailureColumn"},i.a.createElement("div",{className:"FailureValue"},this.state.failedRegions))),!(!this.state.failedRegions&&!this.state.failedDCs)&&i.a.createElement("div",{className:"FailureRow"},i.a.createElement("div",{className:"FailureColumn"},i.a.createElement("div",{className:"FailureHeader"},"Data Centers")),i.a.createElement("div",{className:"FailureColumn"},i.a.createElement("div",{className:"FailureValue"},this.state.failedDCs))),!!(this.state.failedRegions||this.state.failedDCs||this.state.failedAZs)&&i.a.createElement("div",{className:"FailureRow"},i.a.createElement("div",{className:"FailureColumn"},i.a.createElement("div",{className:"FailureHeader"},"Availability Zones")),i.a.createElement("div",{className:"FailureColumn"},i.a.createElement("div",{className:"FailureValue"},this.state.failedAZs))),i.a.createElement("div",{className:"FailureRow"},i.a.createElement("div",{className:"FailureColumn"},i.a.createElement("div",{className:"FailureHeader"},"Nodes")),i.a.createElement("div",{className:"FailureColumn"},i.a.createElement("div",{className:"FailureValue"},this.state.failedNodes))))),i.a.createElement("div",{className:"App-container"},e))}}]),t}(i.a.Component);var P=function(){return i.a.createElement("div",{className:"App"},i.a.createElement("header",{className:"App-header"},i.a.createElement(A,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(P,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[12,1,2]]]);
//# sourceMappingURL=main.e3f4708d.chunk.js.map